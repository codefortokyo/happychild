{% extends "base.html" %}
{% load static %}
{% block content %}
    <!-- Map content start -->
    <div class="map-content content-area container-fluid">
        <div class="col-xs-12 col-sm-12 col-md-5 col-lg-6">
            <div class="row">
                <div id="map"></div>
            </div>
        </div>
        <div class="col-xs-12 col-sm-12 col-md-7 col-lg-6 map-content-sidebar">
            <div class="properties-map-search">
                <form method="get">
                    <div class="properties-map-search-content">
                        <div class="row">
                            {% for error in location_form.non_field_errors %}
                                <div class="form-group has-errors text-danger small">
                                    {{ error }}
                                </div>
                            {% endfor %}
                            {% for field in location_form.visible_fields %}
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                    <div class="form-group">
                                        {{ field }}
                                    </div>
                                </div>
                            {% endfor %}
                            {% for hidden in location_form.hidden_fields %}
                                {{ hidden }}
                            {% endfor %}
                        </div>
                    </div>

                    <div id="options-content">
                        <div class="row">
                            {% for field in type_form.visible_fields %}
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                    <div class="form-group">
                                        {{ field }}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>

                        <div class="row">
                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                {% for field in feature_form.visible_fields %}
                                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                                        <div class="checkbox checkbox-theme checkbox-circle">
                                            {{ field }}{{ field.label_tag }}
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                                <button type="button" class="btn border-button-theme" data-toggle="modal"
                                        data-target=".nursery-score-modal">調整指数を設定する
                                </button>
                            </div>
                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                                <button class="btn btn-default pull-right" type="submit"> 検索</button>
                                <button class="btn btn-default pull-right" type="button"><i
                                        class="fa fa-map-marker geolocation" data-toggle="tooltip"
                                        data-placement="bottom" title="現在位置から検索"
                                        onclick="cmanPosGet();"></i>
                                </button>
                            </div>
                        </div>

                        <div class="modal fade nursery-score-modal" tabindex="-1" role="dialog"
                             aria-labelledby="nurseryScoreModel" aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <p>
                                            現在の状況を選択することで保育園の入所指数を計算し, 過去の入所実績値
                                            から入所可能性の高い保育園を検索することができます.<br>
                                        </p>
                                        <a href="http://www.city.shinagawa.tokyo.jp/hp/page000028000/hpg000027969.htm"
                                           target="_blank">
                                            <p> 参考: 品川区 保育所等利用調整基準(選考基準)</p></a>
                                    </div>
                                    <div class="modal-body">
                                        <div class="form-group">
                                            <p>父の基本指数</p>
                                            <select name="selectName1" class="form-control"
                                                    onChange="calc(this.form)" required>
                                                <option value="0">選択してください</option>
                                                <option value="20">月20日以上勤務し、日中8時間以上の就労が常態</option>
                                                <option value="19">月20日以上勤務し、日中7時間以上の就労が常態</option>
                                                <option value="19">月18日以上勤務し、日中8時間以上の就労が常態</option>
                                                <option value="18">月20日以上勤務し、日中6時間以上の就労が常態</option>
                                                <option value="18">月18日以上勤務し、日中7時間以上の就労が常態</option>
                                                <option value="18">月16日以上勤務し、日中8時間以上の就労が常態</option>
                                                <option value="16">月16日以上勤務し、日中6時間以上の就労が常態</option>
                                                <option value="16">月12日以上勤務し、日中8時間以上の就労が常態</option>
                                                <option value="14">月20日以上勤務し、日中4時間以上の就労が常態</option>
                                                <option value="14">月16日以上勤務し、日中5時間以上の就労が常態</option>
                                                <option value="12">月16日以上勤務し、日中4時間以上の就労が常態</option>
                                                <option value="12">月14日以上勤務し、日中5時間以上の就労が常態</option>
                                                <option value="12">月12日以上勤務し、日中6時間以上の就労が常態</option>
                                                <option value="10">月12日以上勤務し、日中4時間以上の就労が常態</option>
                                                <option value="8">上記のほか、勤務の態様から保育できないと認められる場合</option>
                                                <option value="12">月16日以上、日中5時間以上月収25000円以上の就労が常態</option>
                                                <option value="10">月12日以上、日中4時間以上月収25000円未満の就労が常態</option>
                                                <option value="8">上記のほか、勤務の態様から保育できないと認められる場合</option>
                                                <option value="8">出産前後の休養のため保育にあたることができない場合</option>
                                                <option value="20">おおむね3カ月程度の入院もしくは入院を決定された場合</option>
                                                <option value="20">常時病臥、重度の精神性疾患に罹患し定期的に通院</option>
                                                <option value="18">安静を要する状態(自分の身の回りのことができない場合）</option>
                                                <option value="14">負傷や疾病のため、保育にあたることができないと認められる場合</option>
                                                <option value="14">一般療養で定期的に通院を要し、家事困難</option>
                                                <option value="14">一般療養で定期的に通院を要するが、家事は可能</option>
                                                <option value="20">身障手帳1から2級、愛の手帳1から3度</option>
                                                <option value="16">身障手帳3級、愛の手帳4度</option>
                                                <option value="12">身障手帳4級</option>
                                                <option value="8">身障手帳5級以下</option>
                                                <option value="16">月16日以上、1日6時間以上の通所の付添</option>
                                                <option value="16">月12日以上、1日4時間以上の通所の付添</option>
                                                <option value="16">上記以外の付添</option>
                                                <option value="17">日中1人での常時観察・全面的身体介護をしている場合</option>
                                                <option value="17">上記以外の常時観察・全面的身体介護をしている場合</option>
                                                <option value="17">病人や心身に障害のある方を常時看護、介護している場合</option>
                                                <option value="17">日常生活動作の一部介助が必要</option>
                                                <option value="17">上記以外の介護・看護</option>
                                                <option value="20">災害による家屋の損傷、その災害復旧のため、保育に当たることができない場合</option>
                                                <option value="12">月20日以上勤務し、日中8時間以上の常勤の就労が内定している場合</option>
                                                <option value="8">上記以外の就労が内定している場合 （起業準備を含む）</option>
                                                <option value="4">求職活動中のため</option>
                                                <option value="20">就学・技能習得のため保育にあたることができない場合</option>
                                                <option value="20">死別、離別、行方不明、拘禁</option>
                                                <option value="20">前各号に掲げるもののほか、明らかに保育に当たることができないと認められる場合
                                                    （児童虐待、配偶者からの暴力を含む）
                                                </option>
                                            </select>
                                            <p>母の基本指数</p>
                                            <select name="selectName2" class="form-control"
                                                    onChange="calc(this.form)" required>
                                                <option value="0">選択してください</option>
                                                <option value="20">月20日以上勤務し、日中8時間以上の就労が常態</option>
                                                <option value="19">月20日以上勤務し、日中7時間以上の就労が常態</option>
                                                <option value="19">月18日以上勤務し、日中8時間以上の就労が常態</option>
                                                <option value="18">月20日以上勤務し、日中6時間以上の就労が常態</option>
                                                <option value="18">月18日以上勤務し、日中7時間以上の就労が常態</option>
                                                <option value="18">月16日以上勤務し、日中8時間以上の就労が常態</option>
                                                <option value="16">月16日以上勤務し、日中6時間以上の就労が常態</option>
                                                <option value="16">月12日以上勤務し、日中8時間以上の就労が常態</option>
                                                <option value="14">月20日以上勤務し、日中4時間以上の就労が常態</option>
                                                <option value="14">月16日以上勤務し、日中5時間以上の就労が常態</option>
                                                <option value="12">月16日以上勤務し、日中4時間以上の就労が常態</option>
                                                <option value="12">月14日以上勤務し、日中5時間以上の就労が常態</option>
                                                <option value="12">月12日以上勤務し、日中6時間以上の就労が常態</option>
                                                <option value="10">月12日以上勤務し、日中4時間以上の就労が常態</option>
                                                <option value="8">上記のほか、勤務の態様から保育できないと認められる場合</option>
                                                <option value="12">月16日以上、日中5時間以上月収25000円以上の就労が常態</option>
                                                <option value="10">月12日以上、日中4時間以上月収25000円未満の就労が常態</option>
                                                <option value="8">上記のほか、勤務の態様から保育できないと認められる場合</option>
                                                <option value="8">出産前後の休養のため保育にあたることができない場合</option>
                                                <option value="20">おおむね3カ月程度の入院もしくは入院を決定された場合</option>
                                                <option value="20">常時病臥、重度の精神性疾患に罹患し定期的に通院</option>
                                                <option value="18">安静を要する状態(自分の身の回りのことができない場合）</option>
                                                <option value="14">負傷や疾病のため、保育にあたることができないと認められる場合</option>
                                                <option value="14">一般療養で定期的に通院を要し、家事困難</option>
                                                <option value="14">一般療養で定期的に通院を要するが、家事は可能</option>
                                                <option value="20">身障手帳1から2級、愛の手帳1から3度</option>
                                                <option value="16">身障手帳3級、愛の手帳4度</option>
                                                <option value="12">身障手帳4級</option>
                                                <option value="8">身障手帳5級以下</option>
                                                <option value="16">月16日以上、1日6時間以上の通所の付添</option>
                                                <option value="16">月12日以上、1日4時間以上の通所の付添</option>
                                                <option value="16">上記以外の付添</option>
                                                <option value="17">日中1人での常時観察・全面的身体介護をしている場合</option>
                                                <option value="17">上記以外の常時観察・全面的身体介護をしている場合</option>
                                                <option value="17">病人や心身に障害のある方を常時看護、介護している場合</option>
                                                <option value="17">日常生活動作の一部介助が必要</option>
                                                <option value="17">上記以外の介護・看護</option>
                                                <option value="20">災害による家屋の損傷、その災害復旧のため、保育に当たることができない場合</option>
                                                <option value="12">月20日以上勤務し、日中8時間以上の常勤の就労が内定している場合</option>
                                                <option value="8">上記以外の就労が内定している場合 （起業準備を含む）</option>
                                                <option value="4">求職活動中のため</option>
                                                <option value="20">就学・技能習得のため保育にあたることができない場合</option>
                                                <option value="20">死別、離別、行方不明、拘禁</option>
                                                <option value="20">前各号に掲げるもののほか、明らかに保育に当たることができないと認められる場合
                                                    （児童虐待、配偶者からの暴力を含む）
                                                </option>
                                            </select>
                                            <p>調整指数</p>
                                            <select name="selectName3" class="form-control"
                                                    onChange="calc(this.form)" required>
                                                <option value="0">選択してください</option>
                                                <option value="4">生活保護受給世帯</option>
                                                <option value="6">ひとり親世帯</option>
                                                <option value="4">ひとり親に準ずる世帯</option>
                                                <option value="6">世帯の生計中心者が失業、倒産等により、生計維持のため就労を要するとき</option>
                                                <option value="1">
                                                    区内在住の兄弟姉妹で異なる区内認可保育園に在園しており、第一希望で同一区内認可保育園に転園申請する場合
                                                </option>
                                                <option value="3">
                                                    兄弟姉妹が区内認可保育園に在園している区内在住児童が、区内認可保育園・家庭的保育事業・小規模保育事業に入園申請する場合
                                                </option>
                                                <option value="4">世帯の生計中心者が失業、倒産等により、生計維持のため就労を要するとき</option>
                                                <option value="2">集団保育を必要とする障害児等で、特別支援保育審査会で認められた場合</option>
                                                <option value="2">
                                                    申込児が障害を有するために、通所施設(品川児童学園等)に通所、または病院に定期的に通院している場合
                                                </option>
                                                <option value="1">
                                                    入所を希望する児童を品川区の保育料助成制度の対象となる認可外保育施設等(都道府県に届出がある施設のうち認証保育所を除く）に月額20,000円以上で預けている場合
                                                </option>
                                                <option value="3">
                                                    入所を希望する児童を品川区の保育料助成制度の対象となる認可外保育施設等(都道府県に届出がある施設のうち認証保育所を除く）に月額20,000円未満で預けている場合
                                                </option>
                                                <option value="1">
                                                    入所を希望する児童を品川区の保育料助成制度の対象とならない認可外保育施設等(都道府県に届出がある施設のうち認証保育所を除く）に月額20,000円以上で預けている場合
                                                </option>
                                                <option value="2">
                                                    入所を希望する児童を品川区の保育料助成制度の対象とならない認可外保育施設等(都道府県に届出がある施設のうち認証保育所を除く）に月額20,000円未満で預けている場合
                                                </option>
                                                <option value="2">入所を希望する児童を認証保育所に預けている場合</option>
                                                <option value="2">入所を希望する児童を家庭的保育事業・小規模保育事業に預けている場合</option>
                                                <option value="2">年齢上上限のある区内認可保育園（日本音楽学校保育園、短時間保育室）を卒園する場合
                                                </option>
                                                <option value="1">保護者が単身赴任をしている場合</option>
                                                <option value="1">求職中で求職活動を証明できる公的な書類の提出がある場合 （ハローワークカードなど）
                                                </option>
                                                <option value="1">兄弟姉妹で同時に区内認可保育園・家庭的保育事業・小規模保育事業に入園申請する場合
                                                </option>
                                                <option value="4">
                                                    育児休業法等に基づく育休取得（1年以上）により、育休取得前に品川区認可保育園を退園し、育児休業明けに再入園する場合（育児休業取得対象児童も加点対象）
                                                </option>
                                                <option value="-1">勤務先（仕事場）に児童を同伴している場合※ただし、職場が危険業種の場合は対象外とする
                                                </option>
                                                <option value="-1">同一世帯に未申請児（介護を要する児童を除く）がいる場合</option>
                                                <option value="-1">
                                                    申込締切日時点で給与明細等で確認できる勤務実績が3カ月に満たない場合（1カ月以内の転職等を除く）
                                                </option>
                                                <option value="-2">
                                                    申込締切日時点で育休取得中であり、利用開始月までには復職するが利用開始後3カ月以内に出産予定で、かつ産休取得後に育休取得予定の場合
                                                </option>
                                                <option value="-10">正当な理由もなく、保育料（区立幼稚園・区立認定こども園含む）を滞納している場合
                                                </option>
                                            </select>

                                            <p>階層</p>
                                            <select name="selectName4" class="form-control"
                                                    onChange="judge(this.form)" required>
                                                <option value="0">選択してください</option>
                                                <option value="A">生活保護世帯</option>
                                                <option value="B">当年度分区市町村民税　非課税世帯</option>
                                                <option value="C1">当年度分区市町村民税　均等割のみの世帯</option>
                                                <option value="C2">当年度分区市町村民税　所得割5,000円未満</option>
                                                <option value="C3">当年度分区市町村民税　所得割5,000円以上48,700円未満</option>
                                                <option value="D1">当年度分区市町村民税　所得割48,700円以上50,500円未満</option>
                                                <option value="D2">当年度分区市町村民税　所得割50,500円以上59,800円未満</option>
                                                <option value="D3">当年度分区市町村民税　所得割59,800円以上68,500円未満</option>
                                                <option value="D4">当年度分区市町村民税　所得割68,500円以上88,600円未満</option>
                                                <option value="D5">当年度分区市町村民税　所得割88,600円以上108,600円未満</option>
                                                <option value="D6">当年度分区市町村民税　所得割108,600円以上128,500円未満</option>
                                                <option value="D7">当年度分区市町村民税　所得割128,500円以上148,600円未満</option>
                                                <option value="D8">当年度分区市町村民税　所得割148,600円以上171,600円未満</option>
                                                <option value="D9">当年度分区市町村民税　所得割171,600円以上204,900円未満</option>
                                                <option value="D10">当年度分区市町村民税　所得割204,900円以上228,800円未満</option>
                                                <option value="D11">当年度分区市町村民税　所得割228,800円以上252,900円未満</option>
                                                <option value="D12">当年度分区市町村民税　所得割252,900円以上276,800円未満</option>
                                                <option value="D13">当年度分区市町村民税　所得割276,800円以上300,800円未満</option>
                                                <option value="D14">当年度分区市町村民税　所得割300,800円以上322,000円未満</option>
                                                <option value="D15">当年度分区市町村民税　所得割322,000円以上338,000円未満</option>
                                                <option value="D16">当年度分区市町村民税　所得割338,000円以上354,000円未満</option>
                                                <option value="D17">当年度分区市町村民税　所得割354,000円以上370,000円未満</option>
                                                <option value="D18">当年度分区市町村民税　所得割370,000円以上440,200円未満</option>
                                                <option value="D19">当年度分区市町村民税　所得割440,200円以上500,200円未満</option>
                                                <option value="D20">当年度分区市町村民税　所得割500,200円以上560,200円未満</option>
                                                <option value="D21">当年度分区市町村民税　所得割560,200円以上665,000円未満</option>
                                                <option value="D22">当年度分区市町村民税　所得割665,000円以上772,600円未満</option>
                                                <option value="D23">当年度分区市町村民税　所得割887,500円以上1,031,300円未満
                                                </option>
                                                <option value="D24">当年度分区市町村民税　所得割1,031,300円以上</option>
                                                <option value="D25">当年度分区市町村民税　所得割322,000円以上338,000円未満</option>
                                            </select>
                                            <!-- /.form-group -->
                                            <p>指数</p>
                                            <input name="score" type="text" value="0" style="text-align:right">
                                            <p>階層</p>
                                            <input name="hierarchy" type="text" value="0" style="text-align:right">
                                            <button type="button" class="btn button-theme pull-right" data-dismiss="modal">閉じる
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <div class="map-content-separater"></div>
            <div class="clearfix"></div>

            <div class="fetching-properties"></div>
        </div>
    </div>
    <!-- Map content end -->
{% endblock %}

{% block js %}
    <script type="text/javascript" language="javascript">
        function calc(f) {
            f.score.value = parseInt(f.selectName1.value) + parseInt(f.selectName2.value) + parseInt(f.selectName3.value);
            return f.score.value;
        }

        function judge(f) {
            f.hierarchy.value = f.selectName4.value;
            return f.hierarchy.value;
        }
    </script>
    <script>
        let providerName = 'OpenStreetMap.Mapnik';

        generateMap({{ latitude }}, {{ longitude }}, providerName, 'grid_layout', {{ nurseries|safe }}, 14);
    </script>
{% endblock %}
